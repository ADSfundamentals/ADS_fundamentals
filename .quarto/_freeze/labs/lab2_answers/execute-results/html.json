{
  "hash": "35a0607acf18fe95a980dd714392f4f2",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Lab 2\"\noutput-file: \"lab2_answers.html\"\n#output-file: \"lab2.html\"\nparams:\n  answers: true\n---\n\n\n\n\n\n\n\n\n\n# Part 1: Exploratory data analysis\n\n# Introduction\n\nIn this practical you will learn about exploratory data analysis (EDA). EDA involves inspecting, transforming and visualising data with the goal of finding interesting features to substantiate one or more research questions. This practical will draw on skills you learned in the preparation materials and week 1, while introducing you to some new material like visualisation with `ggplot()`. \n \nYou will need the following packages for this tutorial. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(ggplot2)\nlibrary(ggpubr)\nlibrary(kableExtra)\nlibrary(weathermetrics)\n```\n:::\n\n\nYou will work with the `mpg` dataset from the `ggplot2` package. `mpg` contains a subset of the fuel economy data that EPA makes available [here](https://fueleconomy.gov/). The data frame has 234 rows and 11 variables:\n\n* **manufacturer:** manufacturer name\n* **model:** model name\n* **displ:** engine displacement in litres\n* **year:** year of manufacture\n* **cyl:** number of cylinders\n* **trans:** type of transmission\n* **drv:** type of drive train (f = front-wheel drive; r = rear-wheel drive; 4 = four-wheel drive)\n* **cty:** city miles per gallon\n* **hw:** highway miles per gallon\n* **fl:** fuel type\n* **class\"** type of car\n\nYou can also type `?mpg` into the console to learn more. \n\nLet's get an overview of the data.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(mpg)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 11\n  manufacturer model displ  year   cyl trans      drv     cty   hwy fl    class \n  <chr>        <chr> <dbl> <int> <int> <chr>      <chr> <int> <int> <chr> <chr> \n1 audi         a4      1.8  1999     4 auto(l5)   f        18    29 p     compa…\n2 audi         a4      1.8  1999     4 manual(m5) f        21    29 p     compa…\n3 audi         a4      2    2008     4 manual(m6) f        20    31 p     compa…\n4 audi         a4      2    2008     4 auto(av)   f        21    30 p     compa…\n5 audi         a4      2.8  1999     6 auto(l5)   f        16    26 p     compa…\n6 audi         a4      2.8  1999     6 manual(m5) f        18    26 p     compa…\n```\n\n\n:::\n:::\n\n\nIn previous week we learned that `str()` can be used to get an overview of the data and the structure of a dataframe. You can also use `glimpse()` from the `tidyverse` which returns similar results in a more readable format.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nglimpse(mpg)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 234\nColumns: 11\n$ manufacturer <chr> \"audi\", \"audi\", \"audi\", \"audi\", \"audi\", \"audi\", \"audi\", \"…\n$ model        <chr> \"a4\", \"a4\", \"a4\", \"a4\", \"a4\", \"a4\", \"a4\", \"a4 quattro\", \"…\n$ displ        <dbl> 1.8, 1.8, 2.0, 2.0, 2.8, 2.8, 3.1, 1.8, 1.8, 2.0, 2.0, 2.…\n$ year         <int> 1999, 1999, 2008, 2008, 1999, 1999, 2008, 1999, 1999, 200…\n$ cyl          <int> 4, 4, 4, 4, 6, 6, 6, 4, 4, 4, 4, 6, 6, 6, 6, 6, 6, 8, 8, …\n$ trans        <chr> \"auto(l5)\", \"manual(m5)\", \"manual(m6)\", \"auto(av)\", \"auto…\n$ drv          <chr> \"f\", \"f\", \"f\", \"f\", \"f\", \"f\", \"f\", \"4\", \"4\", \"4\", \"4\", \"4…\n$ cty          <int> 18, 21, 20, 21, 16, 18, 18, 18, 16, 20, 19, 15, 17, 17, 1…\n$ hwy          <int> 29, 29, 31, 30, 26, 26, 27, 26, 25, 28, 27, 25, 25, 25, 2…\n$ fl           <chr> \"p\", \"p\", \"p\", \"p\", \"p\", \"p\", \"p\", \"p\", \"p\", \"p\", \"p\", \"p…\n$ class        <chr> \"compact\", \"compact\", \"compact\", \"compact\", \"compact\", \"c…\n```\n\n\n:::\n:::\n\n\nBefore you begin exploring your data, you need to check that the class or mode of your variables is as expected. You have character/factor and numerical/integer types. \n\n1. **Are there any variables that do not have the class you expect it to?**\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# All variables that are listed as 'character' are categorical and should be listed as 'factor'.\n```\n:::\n\n\n2. **Make any changes you feel are necessary.**\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Here we should change all of the character variables to factor variables with levels. For now, we leave the levels as they are.\n# There are a couple of methods to do this, but the quickest way is using `mutate_if()` which performs a conditional operation. Base R is also fine.\n  \nmpg <- mpg %>% \n  mutate_if(is.character, as.factor)\n\n# If we inspect the data gain using glimpse(), we now see that the character variables are converted into factors\nglimpse(mpg)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 234\nColumns: 11\n$ manufacturer <fct> audi, audi, audi, audi, audi, audi, audi, audi, audi, aud…\n$ model        <fct> a4, a4, a4, a4, a4, a4, a4, a4 quattro, a4 quattro, a4 qu…\n$ displ        <dbl> 1.8, 1.8, 2.0, 2.0, 2.8, 2.8, 3.1, 1.8, 1.8, 2.0, 2.0, 2.…\n$ year         <int> 1999, 1999, 2008, 2008, 1999, 1999, 2008, 1999, 1999, 200…\n$ cyl          <int> 4, 4, 4, 4, 6, 6, 6, 4, 4, 4, 4, 6, 6, 6, 6, 6, 6, 8, 8, …\n$ trans        <fct> auto(l5), manual(m5), manual(m6), auto(av), auto(l5), man…\n$ drv          <fct> f, f, f, f, f, f, f, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, r, …\n$ cty          <int> 18, 21, 20, 21, 16, 18, 18, 18, 16, 20, 19, 15, 17, 17, 1…\n$ hwy          <int> 29, 29, 31, 30, 26, 26, 27, 26, 25, 28, 27, 25, 25, 25, 2…\n$ fl           <fct> p, p, p, p, p, p, p, p, p, p, p, p, p, p, p, p, p, p, r, …\n$ class        <fct> compact, compact, compact, compact, compact, compact, com…\n```\n\n\n:::\n:::\n\n\n\n# Exploratory data analysis\n\n**Exploratory Data Analysis** is a process whereby you examine and transform your data to extract interesting insights and understand what relationships (if any!) exist among the variables. In this way, EDA is closely related to principles of data cleaning because *tidy* data is easier to explore. Initial steps of EDA involve examining distributions, handling missings and outliers, removing redundant data and coding categorical variables properly. \n\nEDA is very flexible and iterative process and gives the researcher a lot of freedom, but it is typically split into *graphical* and *non-graphical* analysis. Further within this framework we can also start to think about what kind of **variation** occurs *within* variables and what kind of **covariation** occurs *between* my variables. \n\n\n## Variation\n\n**Variation** describes how the values of a variable change each time you measure it. A continuous variable that is measured on one occasion will have different values to that same variable measured on another occasion. This variation between measurement occasions are what we call \"error\". Categorical variables also vary across measurement occasions or across individuals. Visualising variation is a very intuitive way to understand trends or patterns within a variable. \n\n\n## Covariation\n\n**Covariation** describes how the values of at least two variables vary together or are related. Again, visualising covariation is also the most intuitive way to understand patterns between variables. \n\n\n## Non-Graphical EDA\n\nIf you are interested in a particular aspect of a variable you can summarise this information in a table. We have covered how to create nicely formatted tables in the previous practical, so the example below is just to refresh your memory. \n\n\n## Summary tables\n\nBelow we summarise `hwy` by vehicle `class`, by asking for commonly used summary statistics. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nmpg %>% \n  group_by(class) %>%         # by class\n  summarise(min = min(hwy),   # minimum of hwy\n            mean = mean(hwy), # mean\n            sd = sd(hwy),     # standard deviation\n            max = max(hwy),   # maximum\n            n = n())  %>%     # nr of observations\n  kbl() %>%  \n  kable_styling(latex_options = c(\"striped\", \"hover\"), full_width = F)  \n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table\" style=\"width: auto !important; margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> class </th>\n   <th style=\"text-align:right;\"> min </th>\n   <th style=\"text-align:right;\"> mean </th>\n   <th style=\"text-align:right;\"> sd </th>\n   <th style=\"text-align:right;\"> max </th>\n   <th style=\"text-align:right;\"> n </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> 2seater </td>\n   <td style=\"text-align:right;\"> 23 </td>\n   <td style=\"text-align:right;\"> 24.80000 </td>\n   <td style=\"text-align:right;\"> 1.303840 </td>\n   <td style=\"text-align:right;\"> 26 </td>\n   <td style=\"text-align:right;\"> 5 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> compact </td>\n   <td style=\"text-align:right;\"> 23 </td>\n   <td style=\"text-align:right;\"> 28.29787 </td>\n   <td style=\"text-align:right;\"> 3.781620 </td>\n   <td style=\"text-align:right;\"> 44 </td>\n   <td style=\"text-align:right;\"> 47 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> midsize </td>\n   <td style=\"text-align:right;\"> 23 </td>\n   <td style=\"text-align:right;\"> 27.29268 </td>\n   <td style=\"text-align:right;\"> 2.135930 </td>\n   <td style=\"text-align:right;\"> 32 </td>\n   <td style=\"text-align:right;\"> 41 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> minivan </td>\n   <td style=\"text-align:right;\"> 17 </td>\n   <td style=\"text-align:right;\"> 22.36364 </td>\n   <td style=\"text-align:right;\"> 2.062655 </td>\n   <td style=\"text-align:right;\"> 24 </td>\n   <td style=\"text-align:right;\"> 11 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> pickup </td>\n   <td style=\"text-align:right;\"> 12 </td>\n   <td style=\"text-align:right;\"> 16.87879 </td>\n   <td style=\"text-align:right;\"> 2.274280 </td>\n   <td style=\"text-align:right;\"> 22 </td>\n   <td style=\"text-align:right;\"> 33 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> subcompact </td>\n   <td style=\"text-align:right;\"> 20 </td>\n   <td style=\"text-align:right;\"> 28.14286 </td>\n   <td style=\"text-align:right;\"> 5.375012 </td>\n   <td style=\"text-align:right;\"> 44 </td>\n   <td style=\"text-align:right;\"> 35 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> suv </td>\n   <td style=\"text-align:right;\"> 12 </td>\n   <td style=\"text-align:right;\"> 18.12903 </td>\n   <td style=\"text-align:right;\"> 2.977973 </td>\n   <td style=\"text-align:right;\"> 27 </td>\n   <td style=\"text-align:right;\"> 62 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n3.  **Create a summary of engine displacement by year, including the minimum, maximum, median, and inter quantile range.**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmpg %>% \n  group_by(year) %>%                    # by year\n  summarise(min = min(displ),           # minimum of engine displacement\n            Q1 = quantile(displ, 0.25), # first quartile\n            median = median(displ),     # median\n            Q3 = quantile(displ, 0.75), # third quartile\n            max = max(displ),           # maximum\n            IQR = Q3 - Q1) %>%          # inter quartile range\n  kbl() %>%  \n  kable_styling(latex_options = c(\"striped\", \"hover\"), full_width = F)          \n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table\" style=\"width: auto !important; margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:right;\"> year </th>\n   <th style=\"text-align:right;\"> min </th>\n   <th style=\"text-align:right;\"> Q1 </th>\n   <th style=\"text-align:right;\"> median </th>\n   <th style=\"text-align:right;\"> Q3 </th>\n   <th style=\"text-align:right;\"> max </th>\n   <th style=\"text-align:right;\"> IQR </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:right;\"> 1999 </td>\n   <td style=\"text-align:right;\"> 1.6 </td>\n   <td style=\"text-align:right;\"> 2.2 </td>\n   <td style=\"text-align:right;\"> 3.0 </td>\n   <td style=\"text-align:right;\"> 4.0 </td>\n   <td style=\"text-align:right;\"> 6.5 </td>\n   <td style=\"text-align:right;\"> 1.8 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 2008 </td>\n   <td style=\"text-align:right;\"> 1.8 </td>\n   <td style=\"text-align:right;\"> 2.5 </td>\n   <td style=\"text-align:right;\"> 3.6 </td>\n   <td style=\"text-align:right;\"> 4.7 </td>\n   <td style=\"text-align:right;\"> 7.0 </td>\n   <td style=\"text-align:right;\"> 2.2 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n## Graphical EDA: **base R** vs **ggplot**\n\nPlots can be made using base R functions like `plot()`, `hist()`, or `barplot()`. Here are some examples of how this works on the `mpg` data. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nhist(mpg$displ)\n```\n\n::: {.cell-output-display}\n![](lab2_answers_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbarplot(table(mpg$cyl))\n```\n\n::: {.cell-output-display}\n![](lab2_answers_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(x = mpg$displ, y = mpg$hwy,\n     xlab = \"Highway mpg\",\n     ylab = \"Engine displacement (L)\")\n```\n\n::: {.cell-output-display}\n![](lab2_answers_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n\nThese plots are quick to produce and are useful for an initial understanding of the data, but the syntax used to create them is specific to the type of plot. In contrast, `ggplot` has a streamlined approach to plotting involving largely the same steps regardless of plot type. Specifically, in `ggplot` we build up visualisations layer by layer using the `+` operator (which is similar to the ` %>% ` operator we are already familiar with). \n\nThe main, important, layers in `ggplot` are:\n\n* Pass the data to `ggplot()`\n* Choose aesthetic mappings with `aes()` \n* Choose geometric components with `geom()`\n* Choose additional labels, themes, and visuals \n* Choose faceting if it is applicable with `facet()`\n\nWhat does this layering system look like? In [*Chapter 3: Data Visualisation*](https://r4ds.had.co.nz/data-visualisation.html) of Hadley Wickham's R4DS book, there is a general ggplot template to give you an idea of how plots are layered. \n\n````r\n```{r}\nggplot(data = <DATA>) + \n  <GEOM_FUNCTION>(\n     mapping = aes(<MAPPINGS>)) +\n  <COORDINATE_FUNCTION> +\n  <FACET_FUNCTION> +\n  <THEME> \n```\n````\n\nBelow is a real example of how this looks. Remember that you do not have to / need to use all of the `ggplot` options (and there are many many more than presented here). However, this gives you an idea of how the layers of these plots are built up. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(iris) + # Data\n  geom_point(mapping = aes(x = Sepal.Length, # Variable on the x-axis\n                           y = Sepal.Width, # Variable on the y-axis\n                           colour = Species)) + # Legend \n  labs(x = \"Sepal Length\",\n       y = \"Sepal Width\", \n       title = \"Relationship between Sepal Length and Width by Species\") +\n  coord_cartesian() + # Default standard for mapping x and y\n  facet_wrap(~Species) + # Splits plot by the species variable\n  theme_bw() # Sets the background theme\n```\n\n::: {.cell-output-display}\n![](lab2_answers_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n:::\n\n\nYou can read about different `ggplot2` options [here](https://ggplot2.tidyverse.org/reference/). The reference guides by [RPubs](https://rpubs.com/arvindpdmn/ggplot2-basics), [STHDA](http://www.sthda.com/english/wiki/ggplot2-essentials) and [Data Novia](https://www.datanovia.com/en/blog/ggplot-examples-best-reference/#scatter-plot) will be useful once you grasp the basics and want to make more complicated visualisations.\n\n\n## Visualising distributions of single variables\n\n#### Categorical variables\n\n**Bar charts** are often used to visualise categorical variables with a finite set of values. Below is an example how to visuailse the distribution of `drv` - the type of drive train in the `mpg` dataset. \n\n`geom_bar` transforms each value of `drv` into a count to be plotted on the y-axis. The x-axis presents the category associated with each count. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(mpg) +\n  geom_bar(aes(x = drv))\n```\n\n::: {.cell-output-display}\n![](lab2_answers_files/figure-html/unnamed-chunk-14-1.png){width=672}\n:::\n:::\n\n\n4. **Create a bar chart that shows a count for the different vehicle classes in `mpg`.**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(mpg) +              # list the dataset\n  geom_bar(aes(x = class)) # geom_bar for a barplot, and the 'class' variable on the x-axis. \n```\n\n::: {.cell-output-display}\n![](lab2_answers_files/figure-html/unnamed-chunk-15-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# geom_bar adds counts on the y-axis by default\n```\n:::\n\n\n5. **Look up different `ggplot` themes, and apply one to the bar chart you just created.**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(mpg) +\n  geom_bar(aes(x = class)) +\n  theme_bw() # Here we add the theme\n```\n\n::: {.cell-output-display}\n![](lab2_answers_files/figure-html/unnamed-chunk-16-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# There are different `ggplot` themes and the one you choose is largely down to personal preference, but you also want one that enhances your data visualisation. Here I choose `+ theme_bw()` but other examples include `+ theme_minimal()` and `+ theme_light()`.\n```\n:::\n\n\n#### Continuous variables\n\n**Histograms** are often used to visualise the distribution of a continuous variable. Below is an example of how to visualise the distribution of `cty` - the number of city miles per gallon in the `mpg` dataset.\n\n`geom_hist` transforms the x-axis into equally spaced \"bins\" and the height of each bar on the y-axis is the number of observations falling in each bin. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(mpg) +\n  geom_histogram(aes(x = cty), \n                 binwidth = 3)\n```\n\n::: {.cell-output-display}\n![](lab2_answers_files/figure-html/unnamed-chunk-17-1.png){width=672}\n:::\n:::\n\n\nYou can change the value of `binwidth` to adjust the width of the intervals. Different binwidths can reveal different patterns in the data. \n\n6. **What happens when you change the value of `binwidth` to `1`? Does the distribution change?**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(mpg) +\n  geom_histogram(aes(x = cty), \n                 binwidth = 1)\n```\n\n::: {.cell-output-display}\n![](lab2_answers_files/figure-html/unnamed-chunk-18-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# The general distribution does not drastically change, but it is now much easier to spot outliers. Specifically, there are two extreme values to the right of the distribution where the city miles per gallon exceed 30 in a small number of cases.\n```\n:::\n\n\n**Density plots** are an alternative to histograms for continuous data. Below is an example of the density of `cty` from the `mpg` data. The argument `fill = \"darkseagreen\"` just adds colour. You can also specify `colour = \"<COLOUR NAME>\"` to change the density line.\n\n`geom_density` transforms the data into smoothed kernel density estimates (basically a smooth histogram). It is useful for continuous data that come from an underlying smooth distribution. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(mpg, aes(x = cty)) +\n  geom_density(fill = \"darkseagreen\") \n```\n\n::: {.cell-output-display}\n![](lab2_answers_files/figure-html/unnamed-chunk-19-1.png){width=672}\n:::\n:::\n\nYou can also include raw data in a histogram in the form of \"rug\" marks. \n\n7. **Add rug marks to plot above by adding the argument `+ geom_rug(size = 1, colour = \"darkorange\")`.**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(mpg, aes(x = cty)) +\n  geom_density(fill = \"darkseagreen\") +\n  geom_rug(size = 1, \n           colour = \"darkorange\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.\nℹ Please use `linewidth` instead.\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](lab2_answers_files/figure-html/unnamed-chunk-20-1.png){width=672}\n:::\n:::\n\n\n## Visualing the distributions of multiple variables\n\n### Continuous - Continuous\n\n**Scatterplots** are often used to explore how two continuous variables covary together. Below is an example of how to visualise covariation between `displ` (engine displacement) and `hwy` (highway miles per gallon) in the `mpg` data. If there is a clear pattern in how the points fall on the x- and y-axes then we can say these variables covary. \n\n`geom_point` plots values of `displ` on the y-axis and values of `hwy` on the x-axis.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(mpg) +\n  geom_point(aes(x = displ, \n                 y = hwy))\n```\n\n::: {.cell-output-display}\n![](lab2_answers_files/figure-html/unnamed-chunk-21-1.png){width=672}\n:::\n:::\n\n\nSome of these values might be clustered together based on another characteristic. You can explore this by adding colour to the aesthetic mappings, for example. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(mpg) +\n  geom_point(aes(x = displ, \n                 y = hwy, \n                 colour = class))\n```\n\n::: {.cell-output-display}\n![](lab2_answers_files/figure-html/unnamed-chunk-22-1.png){width=672}\n:::\n:::\n\n\n8. **Repeat the plot above, but mapping the type of transmission to the `colour` aesthetic. Add a theme and change the titles of the x- and y-axes.**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(mpg) +\n  geom_point(aes(x = displ, \n                 y = hwy, \n                 colour = trans)) +\n  labs(x = \"Engine Displacement (L)\",\n       y = \"Highway miles per gallon\",) +\n  theme_bw()\n```\n\n::: {.cell-output-display}\n![](lab2_answers_files/figure-html/unnamed-chunk-23-1.png){width=672}\n:::\n:::\n\n\nDifferent aesthetic mappings can be combined in one plot. For example, you may want to add a line of best fit to a scatterplot plot, which you can do using `geom_smooth()`. \n\n9. **Create a scatter plot showing the relationship between engine displacement and city miles, including a line of best fit.**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(mpg, aes(x = displ, \n                y = hwy)) +\n  geom_point() +\n  geom_smooth() +\n  labs(x = \"Engine Displacement (L)\",\n       y = \"Highway miles per gallon\",) +\n  theme_bw()\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`geom_smooth()` using method = 'loess' and formula = 'y ~ x'\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](lab2_answers_files/figure-html/unnamed-chunk-24-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# `geom_smooth()` is used to add a line of best fit. The default method is \"loess\" with the formula x ~ y, but you can change this to any other method. For example, you can choose `method = \"lm\"` for a linear best fit line.\n```\n:::\n\n\nYou can fit more than one line in the same plot. This is often useful in multilevel modelling, where different hierarchies (e.g., groups, locations, individuals) have different slopes. \n\n10. **Recreate the previous plot, but adding `colour = class` to the aesthetic mappings. Use `method = \"lm\"` and set `se = FALSE` in `geom_smooth()`. What difference does this make?**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(mpg, aes(x = displ, \n                y = hwy, \n                colour = class)) +\n  geom_point() +\n  geom_smooth(method = lm, \n              se = FALSE) +\n  labs(x = \"Engine Displacement (L)\",\n       y = \"Highway miles per gallon\",) +\n  theme_bw()\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`geom_smooth()` using formula = 'y ~ x'\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](lab2_answers_files/figure-html/unnamed-chunk-25-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# Adding `colour = class` to the aesthetic mappings causes `geom_smooth()` to fit a line for each class of vehicle. Using `method = \"lm\"` with `se = FALSE` fits a linear line without the standard error. Dropping the standard error makes the plot more readable, since they are otherwise overlapping.\n```\n:::\n\n\n### Continuous - Categorical\n\n**Boxplots** are often used to explore the distribution of a continuous variable broken down by a categorical variable. Below is an example of `hwy` broken down by `drv`. \n\n`geom_boxplot` transforms the data to show summary statistics that are represented by the different visual features of the boxplot. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(mpg) +\n  geom_boxplot(aes(x = drv, \n                   y = hwy))\n```\n\n::: {.cell-output-display}\n![](lab2_answers_files/figure-html/unnamed-chunk-26-1.png){width=672}\n:::\n:::\n\n\nThese features of the boxplot are:\n\n* Lower horizontal line\n* Thicker horizontal middle line\n* Upper horizontal line\n* Vertical whiskers\n* Points beyond the whiskers\n\n11. **What do each of these features tell us?**\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Lower horizontal line -> 25th percentile\n# Thicker horizontal middle line -> median\n# Upper horizontal line -> 75th percentile\n# Vertical whiskers -> IQR \n# 1.5 Points beyond the whiskers ->  OUTLIERS\n```\n:::\n\n\n12. **Add `+ coord_flip()` to the plot above. What does this do?**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(mpg) +\n  geom_boxplot(aes(x = drv, y = hwy)) +\n  coord_flip()\n```\n\n::: {.cell-output-display}\n![](lab2_answers_files/figure-html/unnamed-chunk-28-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# coord_flip()` swaps the x- and y-axes.\n```\n:::\n\n\n13. **What can you conclude about the highway miles per gallon of each type of drive train from the boxplot above?**\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# There are many outliers (points beyond the whiskers) for drive train type \"f\", which represents a front-wheel drive. There are no outliers beyond the IQR for the other types of drive train, 4-wheel drive and rear-wheel drive.\n```\n:::\n\n\nThe variable `trans` contains 10 different transmissions types. These 10 categories can be assumed under 2 broader categories: **manual** and **auto**. \n\n14. **Use `mutate()` and `fct_collapse()` to collapse the 10 categories of `trans` to just these 2 categories.**\n\n::: {.cell}\n\n```{.r .cell-code}\nmpg <- mpg %>% \n  mutate(trans = fct_collapse(trans,\n                             \"auto\" = c(\"auto(av)\", \n                                        \"auto(l3)\", \n                                        \"auto(l4)\", \n                                        \"auto(l5)\", \n                                        \"auto(l6)\", \n                                        \"auto(s4)\", \n                                        \"auto(s5)\", \n                                        \"auto(s6)\"),\n                             \"manual\" = c(\"manual(m5)\", \n                                          \"manual(m6)\"))) \n```\n:::\n\n\n15. **Use the previous example to create a boxplot mapping `cty` on the y-axis and `drv` on the x-axis, this time adding the argument `colour = trans` to `aes()`. What has changed?**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(mpg) +\n  geom_boxplot(aes(x = drv, \n                   y = cty, \n                   colour = trans))\n```\n\n::: {.cell-output-display}\n![](lab2_answers_files/figure-html/unnamed-chunk-31-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# Adding the argument `colour = trans` to the aesthetic mappings further splits the drive train into auto and manual.\n\n# Note that you can also perform the above operations in one piped step.\n\nmpg %>% \n    mutate(trans = fct_collapse(trans,\n                             \"auto\" = c(\"auto(av)\", \n                                        \"auto(l3)\", \n                                        \"auto(l4)\", \n                                        \"auto(l5)\", \n                                        \"auto(l6)\", \n                                        \"auto(s4)\", \n                                        \"auto(s5)\", \n                                        \"auto(s6)\"),\n                             \"manual\" = c(\"manual(m5)\", \n                                          \"manual(m6)\"))) %>% \n  ggplot() +\n  geom_boxplot(aes(x = drv, \n                   y = cty, \n                   colour = trans))\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: There was 1 warning in `mutate()`.\nℹ In argument: `trans = fct_collapse(...)`.\nCaused by warning:\n! Unknown levels in `f`: auto(av), auto(l3), auto(l4), auto(l5), auto(l6), auto(s4), auto(s5), auto(s6), manual(m5), manual(m6)\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](lab2_answers_files/figure-html/unnamed-chunk-31-2.png){width=672}\n:::\n:::\n\n\n\n## Facets\n\n**Facets** are a way to split your plot into many subplots according to some categorical variable. \n\nTo do this, you use the command `facet_wrap()` to facet by a single variable. The first argument to `facet_wrap()` is a formula initiated by `~` and a variable name. Below is an example of how this can work on the `mpg` data. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(mpg) + \n  geom_point(aes(x = displ, \n                 y = hwy)) + \n  facet_wrap(~ class, nrow = 2)\n```\n\n::: {.cell-output-display}\n![](lab2_answers_files/figure-html/unnamed-chunk-32-1.png){width=672}\n:::\n:::\n\n\nIt is possible to facet on a combination of two variables using `facet_grid()`. Like before, the first argument is a formula, but containing two variable names separated by `~`. Below is an example of how this can work. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(mpg) + \n  geom_point(aes(x = displ, \n                 y = hwy)) + \n  facet_grid(drv ~ cyl)\n```\n\n::: {.cell-output-display}\n![](lab2_answers_files/figure-html/unnamed-chunk-33-1.png){width=672}\n:::\n:::\n\n\n16. **Notice that there are empty cells in the bottom left facets above. What do you think this means?**\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# There are no rear-wheel drives that have 4 cyclinders, so there is nothing to plot here.\n```\n:::\n\n\n17. **Create a scatter plot of `displ` and `hwy`, faceting by the of `manufacturer` name.**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(mpg) + \n  geom_point(aes(x = displ, \n                 y = hwy)) + \n  facet_wrap(~manufacturer, nrow = 3)\n```\n\n::: {.cell-output-display}\n![](lab2_answers_files/figure-html/unnamed-chunk-35-1.png){width=672}\n:::\n:::\n\n\n18. **Change the names on the axes to be more informative.**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(mpg) + \n  geom_point(aes(x = displ, \n                 y = hwy)) + \n  labs(x = \"Engine displacement (litres)\", \n       y = \"Highway miles per gallon\") +\n  facet_wrap(~manufacturer, nrow = 3) \n```\n\n::: {.cell-output-display}\n![](lab2_answers_files/figure-html/unnamed-chunk-36-1.png){width=672}\n:::\n:::\n\n\n\n## Arranging multiple plots\n\nIf you have multiple plots that you want to arrange on the same page, you can use `ggarrange()` from the `ggpubr` package.\n\nThe first step is creating some plots. For this exercise we will only use the variables `hwy`, `cty`, and `class`. \n\n19. **Create the following three plots:**\n\n**A. A bar plot showing counts of `class`, assigning `class` to the `fill` aesthetic.**\n\n**B. A box plot of `class` by `hwy` per gallon, assigning `class` to the `colour` aesthetic.**\n\n**C. A jittered scatterplot of `hwy` and `cty` miles per gallon, assigning `class` to the `colour` aesthetic.**\n\n**Remember to save each plot as an object to be called upon later.**\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# plot A\np1 <- ggplot(data = mpg, aes(class, fill = class)) +\n        geom_bar() +\n        labs(x = \"Vehicle class\",\n              y = \"Count\") +\n        coord_flip() +  \n        theme_bw()\n\n# plot B\np2 <- ggplot(data = mpg) + \n        geom_boxplot(mapping = aes(x = class, y = hwy, colour = class)) +\n        labs(x = \"Vehicle class\",\n             y = \"Highway mpg\") +\n        coord_flip() +\n        theme_bw()\n# plot C\np3 <- ggplot(data = mpg) + \n        geom_jitter(mapping = aes(x = cty, y = hwy, colour = class)) +\n        labs(x = \"Vehicle class\",\n             y = \"Highway mpg\") +\n        theme_bw()\n\n# I create three plots names \"p1\", \"p2\", and \"p3\", using previous examples to guide me if necessary. For p1 and p2 I add `coord_flip()` to make the categories easier to read.\n```\n:::\n\n\n**D. Use `ggarrange()` to arrange the three plots in one space. `ggarrange()` takes the plots as arguments as well as `ncol` or `nrow` to customise the arrangement**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggarrange(p1, p2, p3, \n          ncol = 2, \n          nrow = 2)\n```\n\n::: {.cell-output-display}\n![](lab2_answers_files/figure-html/unnamed-chunk-38-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# The only necessary arguments are the plots, but specifying `ncol` and `nrow` can improve the appearance. the repetition of the legend is usually something we want to avoid.\n```\n:::\n\n\n**E. Repeat the code from the previous question, adding `common.legend = TRUE` and `legend = \"bottom\"` to `ggarrange()`.**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggarrange(p1, p2, p3, \n          nrow = 2, \n          ncol = 2, \n          vjust = 0.5, \n          common.legend = TRUE,\n          legend = \"bottom\")\n```\n\n::: {.cell-output-display}\n![](lab2_answers_files/figure-html/unnamed-chunk-39-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# Setting `common.legend = TRUE` gets rid of the repetitive legend and slightly improves the look. In this example I move the legend to the bottom position, but \"top\", \"left\", and \"right\" are other options.\n```\n:::\n\n\n\n------------------------------------------------------------------------\n\n# Part 2: Linear regression\n\nWe will use the following packages in this part of the practical:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dplyr)\nlibrary(magrittr)\nlibrary(ggplot2)\nlibrary(gridExtra)\n```\n:::\n\n\nIn this practical, you will learn how to perform regression analyses in `R` using `lm()` and inspect variables by plotting these variables, using `ggplot()`, repeating some topics of the last 3 weeks.\n\n## Loading the dataset\n\nIn the this practical, we will use the built-in data set `iris`. This data set contains the measurement of different iris species (flowers), you can find more information [here](https://www.rdocumentation.org/packages/datasets/versions/3.6.2/topics/iris).\n\n20.  **Load the dataset and explain what variables are measured in the first three columns of your data set.**\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata <- iris # load the data\nhead(iris)   # inspect the data\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  Sepal.Length Sepal.Width Petal.Length Petal.Width Species\n1          5.1         3.5          1.4         0.2  setosa\n2          4.9         3.0          1.4         0.2  setosa\n3          4.7         3.2          1.3         0.2  setosa\n4          4.6         3.1          1.5         0.2  setosa\n5          5.0         3.6          1.4         0.2  setosa\n6          5.4         3.9          1.7         0.4  setosa\n```\n\n\n:::\n\n```{.r .cell-code}\n# The data set contains three different kinds of flowers. The petal leaves and sepal leaves are measured in length and width. All measurements are in centimeters.\n```\n:::\n\n\n## Inspecting the dataset\n\nA good way of eyeballing on a relation between two continuous variables is by creating a scatterplot.\n\n21.  **Plot the sepal length and the petal width variables in a `ggplot` scatter plot (`geom_points`)**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data) +\n  geom_point(aes(Sepal.Length, Petal.Width)) +\n  xlab(\"Sepal length (in cm)\") +\n  ylab(\"Petal width (in cm)\") +\n  labs(col = \"Species\") +\n  theme_minimal() +\n  ggtitle(\"Plot of 2 continous variables\")  + \n  theme(plot.title = element_text(hjust = 0.5))\n```\n\n::: {.cell-output-display}\n![](lab2_answers_files/figure-html/unnamed-chunk-42-1.png){width=672}\n:::\n:::\n\n\nA loess curve can be added to the plot to get a general idea of the relation between the two variables. You can add a loess curve to a ggplot with `stat_smooth(method = \"loess\")`.\n\n22.  **Add a loess curve to the plot under question 2, for further inspection.**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data, aes(x = Sepal.Length, y = Petal.Width)) +\n  geom_point() +\n  stat_smooth(method = \"loess\", se=F, col = \"blue\") +\n  xlab(\"Sepal length (in cm)\") +\n  ylab(\"Petal width (in cm)\") +\n  labs(col = \"Species\") +\n  theme_minimal() +\n  ggtitle(\"Plot of 2 continous variables\")  + \n  theme(plot.title = element_text(hjust = 0.5))\n```\n\n::: {.cell-output-display}\n![](lab2_answers_files/figure-html/unnamed-chunk-43-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# The curve is added to the previous plot by the line `stat_smooth(method = \"loess, se = F, col = \"blue\")`.\n```\n:::\n\n\nTo get a clearer idea of the general trend in the data (or of the relation), a regression line can be added to the plot. A regression line can be added in the same way as a loess curve, the method argument in the function needs to be altered to `lm` to do so.\n\n23.  **Change the loess curve of the previous plot to a regression line. Describe the relation that the line indicates.**\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# In comparison to the previous plot, we now adjust \"method = \"loess\"\" to \"method = \"lm\"\".\nggplot(data, aes(x = Sepal.Length, y = Petal.Width)) +\n  geom_point() +\n  stat_smooth(method = \"lm\", se=F, col = \"blue\") +\n  xlab(\"Sepal length (in cm)\") +\n  ylab(\"Petal width (in cm)\") +\n  labs(col = \"Species\") +\n  theme_minimal() +\n  ggtitle(\"Plot of 2 continous variables\")  + \n  theme(plot.title = element_text(hjust = 0.5))\n```\n\n::: {.cell-output-display}\n![](lab2_answers_files/figure-html/unnamed-chunk-44-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# The line indicates that there seems to be a more or less linear positive relation between the two plotted variables. This means that an increase in sepal length probably indicates an increase in petal width as well.\n```\n:::\n\n\n## Simple linear regression\n\nWith the `lm()` function, you can specify a linear regression model. You can save a model in an object and request summary statistics with the `summary()` command. The model is always specified with the code `outcome_variable ~ predictor`.\n\nWhen a model is stored in an object, you can ask for the coefficients with `coefficients()`. The next code block shows how you would specify a model where petal width is predicted by sepal width, and how summary statistics for this model would look like\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Specify model: outcome = petal width, predictor = sepal width\niris_model1 <- lm(Petal.Width ~ Sepal.Width,\n                  data = iris)\n\nsummary(iris_model1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = Petal.Width ~ Sepal.Width, data = iris)\n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-1.38424 -0.60889 -0.03208  0.52691  1.64812 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept)   3.1569     0.4131   7.642 2.47e-12 ***\nSepal.Width  -0.6403     0.1338  -4.786 4.07e-06 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.7117 on 148 degrees of freedom\nMultiple R-squared:  0.134,\tAdjusted R-squared:  0.1282 \nF-statistic: 22.91 on 1 and 148 DF,  p-value: 4.073e-06\n```\n\n\n:::\n:::\n\n\nThe summary of the model provides:\n\n-   The model formula;\n\n-   Estimated coefficients (with standard errors and their significance tests);\n\n-   Information on the residuals;\n\n-   A general test for the significance of the model (F-test);\n\n-   The (adjusted) R squared as a metric for model performance.\n\nIndividual elements can be extracted by calling specific model elements (e.g. `iris_model1$coefficients`).\n\n24.  **Specify a regression model where Sepal length is predicted by Petal width. Store this model as \\`model1. Supply summary statistics for this model.**\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# specify model\nmodel1 <- lm(Sepal.Length ~ Petal.Width, \n             data = data)\n\n# ask for summary\nsummary(model1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = Sepal.Length ~ Petal.Width, data = data)\n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-1.38822 -0.29358 -0.04393  0.26429  1.34521 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept)  4.77763    0.07293   65.51   <2e-16 ***\nPetal.Width  0.88858    0.05137   17.30   <2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.478 on 148 degrees of freedom\nMultiple R-squared:  0.669,\tAdjusted R-squared:  0.6668 \nF-statistic: 299.2 on 1 and 148 DF,  p-value: < 2.2e-16\n```\n\n\n:::\n:::\n\n\n25.  **Based on the summary of the model, give a substantive interpretation of the regression coefficient.**\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# The regression coefficient indicates the amount of change in the predicted variable when the predictor variable is changed with one unit. In case of the example model, this means that for every centimeter increase in the width of a petal leaf, the predicted length of a sepal leaf increases by 0.89 cm.\n```\n:::\n\n\n26.  **Relate the summary statistics and coefficients to the plots you made in questions 2 - 4.**\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# The coefficients seem to be in accordance with the earlier plots. They are not exactly the same, but indicate a similar positive relationship.\n```\n:::\n\n",
    "supporting": [
      "lab2_answers_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../site_libs/kePrint-0.0.1/kePrint.js\"></script>\n<link href=\"../site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}