{
  "hash": "9b8daaed0fffc3349d756b4fa2efe1e7",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Lab 4\"\n#output-file: \"lab3_answers.html\"\noutput-file: \"lab4.html\"\nparams:\n  answers: false\n---\n\n# Introduction\n\n------------------------------------------------------------------------\n\nIn this practical, the assumptions of the linear regression model will be discussed. You will practice with checking the different assumptions, and practice with accounting for some of the assumptions with additional steps. Please note that these assumptions can only be checked once you have selected a (final) model, as these assumptions 'need' a model that they apply to.\n\nWe will use the following packages in this practical:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(magrittr)\nlibrary(ggplot2) \nlibrary(regclass)\nlibrary(MASS) \n```\n:::\n\n\n------------------------------------------------------------------------\n\n# Data set: Loading & Inspection\n\nFor the first part of this practical, a [dataset](Fish.csv) from a fish market is used. The variables in this fish data set are:\n\n-   Species of the fish\n\n-   Weight of the fish in grams\n\n-   Vertical, length of the fish in cm\n\n-   Diagonal length of the fish in cm\n\n-   Cross length of the fish in cm\n\n-   Height of the fish in cm\n\n-   Diagonal width of the fish in cm\n\n    </li>\n\nDownload the dataset from the GitHub link, store it in the folder of your `Rproject` for this practical and open it in `R`. Also, adjust the column names according to the code below to make them a bit more intuitive.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Read in the data set\ndata_fish <- read.csv(\"Fish.csv\")\n\ncolnames(data_fish) <- c(\"species\", \"weigth\", \"vertical_length\", \"diagonal_length\", \"cross_length\", \"height\", \"diagonal_width\")\n\n# Check the data set with the 'head' function to have a general impression.\ndata_fish %>%\n  head()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  species weigth vertical_length diagonal_length cross_length  height\n1   Bream    242            23.2            25.4         30.0 11.5200\n2   Bream    290            24.0            26.3         31.2 12.4800\n3   Bream    340            23.9            26.5         31.1 12.3778\n4   Bream    363            26.3            29.0         33.5 12.7300\n5   Bream    430            26.5            29.0         34.0 12.4440\n6   Bream    450            26.8            29.7         34.7 13.6024\n  diagonal_width\n1         4.0200\n2         4.3056\n3         4.6961\n4         4.4555\n5         5.1340\n6         4.9274\n```\n\n\n:::\n:::\n\n\n------------------------------------------------------------------------\n\n# Model assumptions\n\nWe will now discuss and check the various model assumptions of linear regression. If steps can be taken to account for a violated assumption, this will also be touched upon.\n\n------------------------------------------------------------------------\n\n## Linearity\n\nWith the assumption of linearity, it is assumed that the relation between the dependent and independent variables is (more or less) linear. You can check this by generating a scatterplot using a predictor variable and outcome variable of the regression model.\n\n1.  **Check whether there is a linear relation between the variables vertical length and the cross length.**\n\n\n\n2.  **Next check the relation between weight and height.**\n\n\n\n3.  **Describe both plots. What differences do you see?**\n\n\n\nWhen a non-linear relation is present, you can either choose another model to use, or transform the predictor before adding it to the model, for example using a log-transformation. Applying a transformation, however, will not always solve the problem, and makes interpretation of the model less intuitive.\n\n4.  **Apply a log-transformation to the weight variable.**\n\n\n\n5.  **Plot the relation between length and weight again, but now including the transformed variable.**\n\n\n\n6.  **Describe if the transformation improved the linear relation.**\n\n\n\n------------------------------------------------------------------------\n\n## Predictor matrix full rank\n\nThis assumption states that:\n\n<li>\n\nthere need to be more observations than predictors (n \\> P).\n\n<li>no predictor can be a linear combination of other predictors; predictors cannot have a very high correlation (multicollinearity).</li>\n\n<br>\n\nThe first part of this assumption is easy to check: see if the number of observations minus the number of predictors is a positive number. The second part can be checked by either obtaining correlations between the predictors, or by determining the VIF (variance inflation factor). When the VIF is above 10, this indicate high multicollinearity. To account for this, predictors can be excluded from the model, or a new variable can be constructed based on predictors with a high correlation.\n\nTo examine VIF scores, the function `VIF()` from the `regclass` can be used on a prespecified model. If this model includes a categorical variable with multiple categories, such as 'species' in the example data, the generalized VIF is used, and we have to look at the third column (GVIF\\^\\*(1/(2\\*Df))), these values can be compared to normal VIF values.\n\n7.  **Specify a linear model with `weight` as outcome variable using all other variables in the dataset as predictors. Save this model as `model_fish1`. Calculate VIF values for this model.**\n\n\n\n8.  **Check the VIF scores. If VIF scores exceed a score of 10, give substantial explanation why the VIF scores are this high.**\n\n\n\n9.  **What adjustments can be made to the model to account for multicollinearity in this case?**\n\n\n\n10. **Run a new model which only includes one of the three length variables and call it `model_fish2`. Describe if there is an improvement.**\n\n\n\n11. **What happens with the regression model when there are more predictors than observations?**\n\n\n\n------------------------------------------------------------------------\n\n## Exogenous predictors\n\nFor this assumption, the expected value of the errors (mean of the errors) must be 0. Furthermore, The errors must be independent of the predictors.\n\n12. **What is the possible consequence of not meeting this assumption?**\n\n\n\n------------------------------------------------------------------------\n\n## Constant, finite error variance\n\nThis assumptions is also called 'the assumption of homoscedasticity'. It states that the variance of the error terms should be constant over all levels of the predictors. This can be checked by plotting the residuals against the fitted values. These plots can be obtained by simply taking the first plot of a specified model, `plot(model_x)`.\n\n13. **Create a residual vs fitted values plot for `model_fish1`, which is the first plot generated by the `plot()` function.**\n\n\n\n14. **Load in the `iris` data, and specify a model where sepal length is predicted by all other variables and save this as `model_iris1`.**\n\n\n\n15. **Create a residual vs fitted plot for this model as well.**\n\n\n\n16. **Discuss both plots and indicate whether the assumption is met.**\n\n\n\n17. **Discuss what the consequence would be if this assumption is violated.**\n\n\n\n------------------------------------------------------------------------\n\n## Independent errors\n\nThis assumption states that error terms should have no correlation. Dependence of the errors can result from multiple things. First, there is a possible dependence in the error terms when there is serial dependence, for example because the data contains variables that are measured over time. Another reason can be when there is a cluster structure in the data, for example students in classes in schools.\n\n18. **How can both causes of correlated error terms be detected, and what can be done to solve the problem?**\n\n\n\n------------------------------------------------------------------------\n\n## Normally distributed errors\n\nThis assumption states that errors should be roughly normally distributed. Like the assumption of homoscedasticity, this can be checked by model plots, provided by R.\n\n19. **Create a QQ plot for `model_iris1`, which is the second plot generated by the `plot()` function. Indicate whether the assumption is met.**\n\n\n\n20. **Create a new model using the fish data, where `diagonal_width` is predicted by `cross_length`, and store the model as `model_fish3`.**\n\n\n\n21. **Create a QQ plot for `model_fish3`.**\n\n\n\n22. **Interpret the two plots. Is the assumption met in both cases?**\n\n\n\n23. **In what cases is it problematic that the assumption is not met? And in what cases is it no problem?**\n\n\n\n------------------------------------------------------------------------\n\n# Influential observations\n\n------------------------------------------------------------------------\n\n## Outliers\n\nOutliers are observations that show extreme outcomes compared to the other data, or observations with outcome values that fit the model very badly. Outliers can be detected by inspecting the *externally studentized residuals*.\n\n24. **Make a plot of studentized residuals by using the functions `rstudent` and `plot` for \\`model_fish1. What do you conclude?**\n\n\n\n25. **Make a plot of studentized residuals for `model_iris1`.**\n\n\n\n26. **Store the dataset `Animals` from the `MASS` package. Define a regression model where animals' body weight is predicted by brain weight and store it as `model_animals1`.**\n\n\n\n27. **Make a plot of the studentized residuals for `model_animals1`.**\n\n\n\n------------------------------------------------------------------------\n\n## High-leverage observations\n\nHigh-leverage observations are observations with extreme predictor values. To detect these observations, we look at their *leverage values*. These values can be summarized in a leverage plot.\n\n28. **For the model specified under model_animals1, create a leverage plot by plotting the `hatvalues()` of the model.**\n\n\n\n------------------------------------------------------------------------\n\n## Influence on the model\n\nBoth outliers and observations with high leverage are not necessarily a problem. Cases that are both, however, seem to form more of a problem. These cases can influence the model heavily and can therefore be problematic.\n\nInfluence measures come in two sorts: Cook's distance checks for influential observations, while DFBETAS check for influential, and possible problematic, observations per regression coefficients.\n\n29. **For `model_animals1`, check Cooks distance by plotting the `cooks.distance` of the model.**\n\n\n\n30. **For `model_animals1`, check the DFBETAS by using the function `dfbetas`.**\n\n\n\n31. **Describe what you see in the plots for Cook's distance and DFBETAS. What do you conclude?**\n\n\n\n32. **Delete the problematic observation that you found in Question 12 and store the dataset under a new name.**\n\n\n\n33. **Fit the regression model where animals' body weight is predicted by brain weight using the adjusted dataset and store it as `model_animals2`.**\n\n\n\n34. **Compare the output to `model_animals1` and describe the changes.**\n\n\n\n35. **Run the plots for influential observations again on this new model and see if anything changes.**\n\n\n",
    "supporting": [
      "lab4_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}